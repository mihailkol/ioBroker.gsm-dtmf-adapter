<!DOCTYPE html>
<html>
<head>
  <title>GSM DTMF Adapter Settings</title>
  <link rel="stylesheet" href="../../lib/css/materialize.css">
  <script src="../../lib/js/materialize.js"></script>
  <script src="../../lib/js/socket.io.js"></script>
  <script src="../../lib/js/adapter-settings.js"></script>
  <script src="settings.js"></script>
</head>
<body>
  <div class="container">
    <h1>GSM DTMF Adapter Settings</h1>
    <form id="settings-form">
      <label for="modemPort">Modem Port:</label>
      <input type="text" id="modemPort" name="modemPort" required><br><br>

      <label for="baudRate">Baud Rate:</label>
      <input type="number" id="baudRate" name="baudRate" required><br><br>

      <button type="submit" class="btn waves-effect waves-light">Save</button>
    </form>
  </div>

  <script>
    // Загрузка настроек при открытии страницы
    function loadSettings() {
      socket.emit('getObject', 'system.adapter.gsm-dtmf-adapter.0', function (err, obj) {
        if (obj && obj.native) {
          document.getElementById('modemPort').value = obj.native.modemPort || '/dev/ttyUSB0';
          document.getElementById('baudRate').value = obj.native.baudRate || 9600;
        }
      });
    }

    // Сохранение настроек
    function saveSettings() {
      const modemPort = document.getElementById('modemPort').value;
      const baudRate = document.getElementById('baudRate').value;

      const settings = {
        modemPort,
        baudRate
      };

      socket.emit('setObject', 'system.adapter.gsm-dtmf-adapter.0', { native: settings }, function (err) {
        if (err) {
          alert('Error saving settings: ' + err);
        } else {
          alert('Settings saved successfully!');
          loadSettings(); // Перезагрузка данных после сохранения
        }
      });
    }

    // Обработка отправки формы
    document.getElementById('settings-form').addEventListener('submit', function (e) {
      e.preventDefault();
      saveSettings();
    });

    // Загрузка настроек при открытии страницы
    window.onload = loadSettings;
  </script>
</body>
</html>
